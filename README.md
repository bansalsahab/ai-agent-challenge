# Agent-as-Coder

An autonomous agent that generates PDF-to-CSV parser code for banking statements, runs unit tests, and iteratively self-fixes until the parser output matches a provided sample CSV.

<!-- badges -->

## Table of Contents

- [Quick start](#quick-start-5-steps)
- [Example CLI usage](#example-cli-usage)
- [Agent diagram](#agent-diagram)
- [Parser contract](#parser-contract)
- [Files produced](#files-produced-by-the-agent)
- [Testing](#testing)
- [Environment & Gemini key](#environment--gemini-key-referrer)
- [Dependencies](#dependencies)
- [Troubleshooting & tips](#troubleshooting--tips)
- [License & contact](#license--contact)

---

## Quick start (5 steps)

1. **Clone the repository**

```bash
git clone https://github.com/your-username/Agent-as-Coder.git
cd Agent-as-Coder
Create a virtual environment and install dependencies

bash
python -m venv .venv
source .venv/bin/activate      # for macOS/Linux
# .\.venv\Scripts\Activate.ps1  # for Windows PowerShell
pip install -r requirements.txt
Place a sample PDF + CSV for a target under data/<target>/

bash
 
mkdir -p data/icici
# place files:
# data/icici/icici_sample.pdf
# data/icici/icici_sample.csv
Run the agent to generate a parser for the target

bash
 
python agent.py --target icici
Run the test for the generated parser

bash
 
pytest -q tests/test_icici_parser.py
Example CLI usage
Generate parser for ICICI sample:

bash
 
python agent.py --target icici
Run the generated parser directly (optional):

bash
 
python -c "from custom_parsers.icici_parser import parse; import pandas as pd; print(parse('data/icici/icici_sample.pdf'))"
Agent diagram
The agent autonomously analyzes a sample bank statement PDF and its corresponding CSV. It first infers the CSV schema, then generates a custom parser module inside custom_parsers/<target>_parser.py. The agent writes a unit test that compares the parser’s output to the expected CSV, executes pytest, and—if the test fails—automatically analyzes the diff, applies targeted fixes (e.g., column mapping, date normalization, type correction), and retries up to three times. Extraction uses pdfplumber for tables, falling back to OCR (pdf2image + pytesseract) if necessary.

ASCII Flow Diagram
pgsql
 
 ┌──────────────────────────┐
 │   Input PDF + CSV pair   │
 └────────────┬─────────────┘
              │
              ▼
 ┌──────────────────────────┐
 │ 1. Infer CSV schema      │
 └────────────┬─────────────┘
              │
              ▼
 ┌──────────────────────────┐
 │ 2. Generate parser code  │
 │    → custom_parsers/     │
 └────────────┬─────────────┘
              │
              ▼
 ┌──────────────────────────┐
 │ 3. Create test file      │
 │    → tests/test_*.py     │
 └────────────┬─────────────┘
              │
              ▼
 ┌──────────────────────────┐
 │ 4. Run pytest            │
 └────────────┬─────────────┘
              │
     ┌────────┴────────┐
     │                 │
     ▼                 ▼
┌──────────┐     ┌────────────┐
│ Test OK  │     │ Test FAIL  │
└────┬─────┘     └────┬───────┘
     │                │
     ▼                ▼
  ✅ Done       5. Auto-fix diff
                   ↑
                   │
                   └── (Retry up to 3 attempts)
Parser contract
Every generated parser must implement:

python
 
def parse(pdf_path: str) -> pandas.DataFrame
Requirements:

Output must match the sample CSV schema exactly (column names and order).

Date normalization: YYYY-MM-DD (ISO format).

Numeric normalization: floats, no commas or currency symbols.

Missing values: represented as NaN.

Deterministic output for the same input.

Include header comment:
# Autogenerated by agent.py — safe to edit

Files produced by the agent
agent.py — CLI orchestrator and self-fix loop.

custom_parsers/<target>_parser.py — generated parser code.

tests/test_<target>_parser.py — generated unit test.

README.md — documentation (this file).

Testing
Run unit tests using:

bash
 
pytest -q tests/test_icici_parser.py
Test behavior:

Loads data/<target>/<target>_sample.csv as expected_df.

Compares it with parse('data/<target>/<target>_sample.pdf') output.

Asserts DataFrame.equals(expected_df) is True.

On failure, the agent attempts up to 3 automated repair cycles (e.g., fixing columns, formatting, or datatypes).
# Agent-as-Coder

An agent that generates a PDF→CSV parser, writes a test, runs pytest, and attempts small auto-fixes (up to 3 attempts).

<!-- badges -->

## Quick start (5 steps)

1. Clone the repo

```powershell
git clone https://github.com/your-username/Agent-as-Coder.git
cd Agent-as-Coder
```

2. Create a virtualenv and install dependencies

```powershell
python -m venv .venv; .\.venv\Scripts\Activate.ps1; pip install -r requirements.txt
```

3. Add sample PDF + CSV under `data/<target>/`

```powershell
mkdir -Force data\icici
# add data\icici\icici_sample.pdf
# add data\icici\icici_sample.csv
```

4. Run the agent

```powershell
python agent.py --target icici
```

5. Run the generated parser test

```powershell
pytest -q tests/test_icici_parser.py
```

## Agent diagram

One-paragraph: the agent infers the CSV schema, generates a parser module in `custom_parsers/`, writes a unit test that compares parser output to the sample CSV, runs pytest, and if the test fails applies targeted fixes (column mapping or date-format tweaks) and retries up to three times.

## Example CLI usage

```powershell
python agent.py --target icici --verbose
```

## Parser contract

- `def parse(pdf_path: str) -> pandas.DataFrame`
- Output must match the sample CSV (column names + order).
- Dates and numbers must be normalized to match the sample.
- Missing values must be `NaN`.

## Testing

Run the integration test the agent generates:

```powershell
pytest -q tests/test_icici_parser.py
```

## Troubleshooting (brief)

- If table extraction is empty: ensure OCR fallback is available (install Tesseract).
- If DataFrame.equals fails: verify column order, date format, and numeric normalization.
